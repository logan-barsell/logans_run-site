<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
    <title>Logan's Run Project</title>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="%PUBLIC_URL%/favicons/apple-touch-icon.png"
    />
    <link
      rel="manifest"
      href="%PUBLIC_URL%/favicons/site.webmanifest"
    />
    <script>
      // Fetch theme and set CSS variables before pace loads
      (function () {
        // Initialize theme with defaults
        let theme = {
          paceTheme: 'center-atom',
        };

        // Try to fetch theme with timeout and error handling for mobile
        try {
          var xhr = new XMLHttpRequest();
          xhr.open('GET', '/api/theme', false);
          xhr.timeout = 3000; // 3 second timeout for mobile
          xhr.onerror = function () {
            console.warn('Theme fetch failed (network error), using defaults');
          };
          xhr.ontimeout = function () {
            console.warn('Theme fetch timed out, using defaults');
          };
          xhr.send();

          if (xhr.status === 200 && xhr.responseText) {
            try {
              theme = JSON.parse(xhr.responseText);
            } catch (error) {
              console.warn('Theme parse failed, using defaults:', error);
            }
          } else {
            console.warn(
              'Theme fetch returned status:',
              xhr.status,
              'using defaults'
            );
          }
        } catch (error) {
          console.warn('Theme fetch failed, using defaults:', error);
        }

        // Set CSS variables
        const root = document.documentElement;
        if (theme.primaryColor)
          root.style.setProperty('--main', theme.primaryColor);
        if (theme.secondaryColor)
          root.style.setProperty('--secondary', theme.secondaryColor);
        if (theme.primaryFont)
          root.style.setProperty('--primary-font', theme.primaryFont);
        if (theme.secondaryFont) {
          let fontStack = "'Courier New', Courier, monospace";
          switch (theme.secondaryFont) {
            case 'Fira Mono':
              fontStack = "'Fira Mono', 'Courier New', Courier, monospace";
              break;
            case 'JetBrains Mono':
              fontStack = "'JetBrains Mono', 'Courier New', Courier, monospace";
              break;
            case 'Roboto Mono':
              fontStack = "'Roboto Mono', 'Courier New', Courier, monospace";
              break;
          }
          root.style.setProperty('--secondary-font', fontStack);
        }

        // Set basic pace options
        window.paceOptions = {
          eventLag: false,
          ajax: false,
          elements: { selectors: ['#root'] },
          restartOnRequestAfter: false,
          target: '#root',
          className: `pace-theme-${theme.paceTheme || 'center-atom'}`,
        };

        // Load the pace theme CSS from local files
        const themeName = theme.paceTheme || 'center-atom';
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = `/themes/pace/${themeName}.css`;
        document.head.appendChild(link);
      })();
    </script>
    <script src="%PUBLIC_URL%/pace.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Sancreek"
      rel="stylesheet"
    />
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <div class="modal-container"></div>
    <div class="cart-container"></div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
